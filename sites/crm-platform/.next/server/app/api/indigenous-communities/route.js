"use strict";(()=>{var e={};e.id=2694,e.ids=[2694],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27524:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>x,patchFetch:()=>N,requestAsyncStorage:()=>l,routeModule:()=>g,serverHooks:()=>h,staticGenerationAsyncStorage:()=>y});var i={};n.r(i),n.d(i,{DELETE:()=>p,GET:()=>m,POST:()=>d,PUT:()=>c});var o=n(49303),r=n(88716),s=n(60670),a=n(87070),u=n(72331);async function m(e){try{let{searchParams:t}=new URL(e.url),n=parseInt(t.get("page")||"1"),i=parseInt(t.get("limit")||"10"),o=t.get("search")||"",r=t.get("sortBy")||"authorityName",s=t.get("sortOrder")||"asc",m=(n-1)*i,d=o?{OR:[{authorityName:{contains:o,mode:"insensitive"}},{associatedIndigenousCommunities:{contains:o,mode:"insensitive"}}]}:{},c=await u._.indigenousCommunity.count({where:d}),p=(await u._.indigenousCommunity.findMany({where:d,skip:m,take:i,orderBy:{[r]:s},select:{id:!0,authorityName:!0,associatedIndigenousCommunities:!0,createdAt:!0,updatedAt:!0}})).map(e=>({...e,name:e.authorityName}));return a.NextResponse.json({data:p,pagination:{total:c,page:n,limit:i,totalPages:Math.ceil(c/i)}})}catch(e){return console.error("Error fetching indigenous communities:",e),a.NextResponse.json({error:"Failed to fetch indigenous communities"},{status:500})}}async function d(e){try{let{name:t,...n}=await e.json(),i=await u._.indigenousCommunity.create({data:{authorityName:t,...n}});return a.NextResponse.json({...i,name:i.authorityName},{status:201})}catch(e){return console.error("Error creating indigenous community:",e),a.NextResponse.json({error:"Failed to create indigenous community"},{status:500})}}async function c(e){try{let{id:t,name:n,...i}=await e.json(),o=await u._.indigenousCommunity.update({where:{id:t},data:{authorityName:n,...i}});return a.NextResponse.json({...o,name:o.authorityName})}catch(e){return console.error("Error updating indigenous community:",e),a.NextResponse.json({error:"Failed to update indigenous community"},{status:500})}}async function p(e){try{let{searchParams:t}=new URL(e.url),n=t.get("id");if(!n)return a.NextResponse.json({error:"ID is required"},{status:400});return await u._.indigenousCommunity.delete({where:{id:n}}),a.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting indigenous community:",e),a.NextResponse.json({error:"Failed to delete indigenous community"},{status:500})}}let g=new o.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/indigenous-communities/route",pathname:"/api/indigenous-communities",filename:"route",bundlePath:"app/api/indigenous-communities/route"},resolvedPagePath:"/home/bish/Downloads/sites/crm-platform/app/api/indigenous-communities/route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:l,staticGenerationAsyncStorage:y,serverHooks:h}=g,x="/api/indigenous-communities/route";function N(){return(0,s.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:y})}},72331:(e,t,n)=>{n.d(t,{_:()=>r});var i=n(53524);let o=globalThis;o.prisma||(o.prisma=new i.PrismaClient({log:["error"]}));let r=o.prisma}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),i=t.X(0,[9380,5972],()=>n(27524));module.exports=i})();