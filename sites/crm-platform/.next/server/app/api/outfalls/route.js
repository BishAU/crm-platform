"use strict";(()=>{var e={};e.id=1391,e.ids=[1391],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},18940:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>x,patchFetch:()=>N,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>h,staticGenerationAsyncStorage:()=>g});var r={};a.r(r),a.d(r,{DELETE:()=>d,GET:()=>u,POST:()=>c,PUT:()=>p});var o=a(49303),s=a(88716),n=a(60670),l=a(87070),i=a(72331);async function u(e){try{let{searchParams:t}=new URL(e.url),a=parseInt(t.get("page")||"1"),r=parseInt(t.get("limit")||"10"),o=t.get("search")||"",s=t.get("sortBy")||"outfallName",n=t.get("sortOrder")||"asc",u=(a-1)*r,c=o?{OR:[{outfallName:{contains:o,mode:"insensitive"}},{authority:{contains:o,mode:"insensitive"}},{type:{contains:o,mode:"insensitive"}},{state:{contains:o,mode:"insensitive"}}]}:{},p=await i._.outfall.count({where:c}),d=(await i._.outfall.findMany({where:c,skip:u,take:r,orderBy:{[s]:n},select:{id:!0,outfallName:!0,authority:!0,contact:!0,contact_email:!0,contact_name:!0,indigenousNation:!0,landCouncil:!0,latitude:!0,longitude:!0,state:!0,type:!0,createdAt:!0,updatedAt:!0}})).map(e=>({...e,name:e.outfallName}));return l.NextResponse.json({data:d,pagination:{total:p,page:a,limit:r,totalPages:Math.ceil(p/r)}})}catch(e){return console.error("Error fetching outfalls:",e),l.NextResponse.json({error:"Failed to fetch outfalls"},{status:500})}}async function c(e){try{let{name:t,...a}=await e.json(),r=await i._.outfall.create({data:{outfallName:t,...a}});return l.NextResponse.json({...r,name:r.outfallName},{status:201})}catch(e){return console.error("Error creating outfall:",e),l.NextResponse.json({error:"Failed to create outfall"},{status:500})}}async function p(e){try{let{id:t,name:a,...r}=await e.json(),o=await i._.outfall.update({where:{id:t},data:{outfallName:a,...r}});return l.NextResponse.json({...o,name:o.outfallName})}catch(e){return console.error("Error updating outfall:",e),l.NextResponse.json({error:"Failed to update outfall"},{status:500})}}async function d(e){try{let{searchParams:t}=new URL(e.url),a=t.get("id");if(!a)return l.NextResponse.json({error:"ID is required"},{status:400});return await i._.outfall.delete({where:{id:a}}),l.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting outfall:",e),l.NextResponse.json({error:"Failed to delete outfall"},{status:500})}}let f=new o.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/outfalls/route",pathname:"/api/outfalls",filename:"route",bundlePath:"app/api/outfalls/route"},resolvedPagePath:"/home/bish/Downloads/sites/crm-platform/app/api/outfalls/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:h}=f,x="/api/outfalls/route";function N(){return(0,n.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:g})}},72331:(e,t,a)=>{a.d(t,{_:()=>s});var r=a(53524);let o=globalThis;o.prisma||(o.prisma=new r.PrismaClient({log:["error"]}));let s=o.prisma}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9380,5972],()=>a(18940));module.exports=r})();