"use strict";(()=>{var e={};e.id=5347,e.ids=[5347],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},22018:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>m,routeModule:()=>f,serverHooks:()=>g,staticGenerationAsyncStorage:()=>y});var r={};a.r(r),a.d(r,{DELETE:()=>d,GET:()=>l,POST:()=>u,PUT:()=>p});var i=a(49303),s=a(88716),n=a(60670),o=a(87070),c=a(72331);async function l(e){try{let t=e.nextUrl.searchParams,a=parseInt(t.get("page")||"1"),r=parseInt(t.get("limit")||"10"),i=t.get("search")||"",s=t.get("sortBy")||"facilityName",n=t.get("sortOrder")||"asc",l=(a-1)*r,u=i?{OR:[{facilityName:{contains:i,mode:"insensitive"}},{type:{contains:i,mode:"insensitive"}},{sector:{contains:i,mode:"insensitive"}}]}:{},p=await c._.facility.count({where:u}),d=(await c._.facility.findMany({where:u,skip:l,take:r,orderBy:{[s]:n},select:{id:!0,facilityName:!0,latitude:!0,longitude:!0,postcode:!0,regionType:!0,sector:!0,suburb:!0,type:!0,createdAt:!0,updatedAt:!0}})).map(e=>({...e,name:e.facilityName}));return o.NextResponse.json({data:d,pagination:{total:p,page:a,limit:r,totalPages:Math.ceil(p/r)}})}catch(e){return console.error("Error fetching facilities:",e),o.NextResponse.json({error:"Failed to fetch facilities"},{status:500})}}async function u(e){try{let{name:t,...a}=await e.json(),r=await c._.facility.create({data:{facilityName:t,...a}});return o.NextResponse.json({...r,name:r.facilityName},{status:201})}catch(e){return console.error("Error creating facility:",e),o.NextResponse.json({error:"Failed to create facility"},{status:500})}}async function p(e){try{let{id:t,name:a,...r}=await e.json(),i=await c._.facility.update({where:{id:t},data:{facilityName:a,...r}});return o.NextResponse.json({...i,name:i.facilityName})}catch(e){return console.error("Error updating facility:",e),o.NextResponse.json({error:"Failed to update facility"},{status:500})}}async function d(e){try{let t=e.nextUrl.searchParams.get("id");if(!t)return o.NextResponse.json({error:"ID is required"},{status:400});return await c._.facility.delete({where:{id:t}}),o.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting facility:",e),o.NextResponse.json({error:"Failed to delete facility"},{status:500})}}let f=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/facilities/route",pathname:"/api/facilities",filename:"route",bundlePath:"app/api/facilities/route"},resolvedPagePath:"/home/bish/Downloads/sites/crm-platform/app/api/facilities/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:y,serverHooks:g}=f,h="/api/facilities/route";function x(){return(0,n.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:y})}},72331:(e,t,a)=>{a.d(t,{_:()=>s});var r=a(53524);let i=globalThis;i.prisma||(i.prisma=new r.PrismaClient({log:["error"]}));let s=i.prisma}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9380,5972],()=>a(22018));module.exports=r})();